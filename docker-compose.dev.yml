services:

  burner-ffmpeg:
    build:
      context: .
      dockerfile: containers/burner-ffmpeg/Dockerfile
      args:
        BASE_NODE_IMAGE: mirror.gcr.io/library/node:18-slim
    container_name: burner-ffmpeg
    environment:
      - NODE_ENV=development
      # Keep in sync with cloudflare/media-orchestrator/wrangler.toml [vars].
      - JOB_CALLBACK_HMAC_SECRET=replace-with-strong-secret
    ports:
      - "8080:8080"

  renderer-remotion:
    build:
      context: .
      dockerfile: containers/renderer-remotion/Dockerfile
      args:
        BASE_NODE_IMAGE: mirror.gcr.io/library/node:22-bookworm-slim
    container_name: renderer-remotion
    environment:
      - NODE_ENV=development
      # Keep in sync with cloudflare/media-orchestrator/wrangler.toml [vars].
      - JOB_CALLBACK_HMAC_SECRET=replace-with-strong-secret
    ports:
      - "8090:8090"

  media-downloader:
    build:
      context: .
      dockerfile: containers/media-downloader/Dockerfile
      args:
        BASE_NODE_IMAGE: mirror.gcr.io/library/node:22-slim
    container_name: media-downloader
    environment:
      - NODE_ENV=development
      # Keep in sync with cloudflare/media-orchestrator/wrangler.toml [vars].
      - JOB_CALLBACK_HMAC_SECRET=replace-with-strong-secret
      - CLASH_SUBSCRIPTION_URL=${CLASH_SUBSCRIPTION_URL:-}
      - CLASH_MODE=${CLASH_MODE:-Rule}
      - MIHOMO_PORT=${MIHOMO_PORT:-7890}
    ports:
      - "8100:8080"

  audio-transcoder:
    build:
      context: .
      dockerfile: containers/audio-transcoder/Dockerfile
      args:
        BASE_NODE_IMAGE: mirror.gcr.io/library/node:18-slim
    container_name: audio-transcoder
    environment:
      - NODE_ENV=development
      - JOB_CALLBACK_HMAC_SECRET=replace-with-strong-secret
    ports:
      - "8110:8080"
